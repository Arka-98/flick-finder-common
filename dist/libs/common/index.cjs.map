{"version":3,"sources":["../../../libs/common/src/index.ts","../../../libs/common/src/common.module.ts","../../../libs/common/src/common.service.ts","../../../libs/common/src/guards/auth.guard.ts","../../../libs/common/src/decorators/public.decorator.ts","../../../libs/common/src/guards/role.guard.ts","../../../libs/common/src/decorators/roles.decorator.ts"],"sourcesContent":["export * from './common.module';\nexport * from './common.service';\n","import { Module } from '@nestjs/common';\nimport { CommonService } from './common.service';\nimport { APP_GUARD } from '@nestjs/core';\nimport { AuthGuard, RoleGuard } from './guards';\n\n@Module({\n  providers: [\n    CommonService,\n    { provide: APP_GUARD, useClass: AuthGuard },\n    { provide: APP_GUARD, useClass: RoleGuard },\n  ],\n  exports: [CommonService],\n})\nexport class CommonModule {}\n","import { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class CommonService {}\n","import {\n  type CanActivate,\n  type ExecutionContext,\n  Injectable,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { Reflector } from '@nestjs/core';\nimport { JwtService } from '@nestjs/jwt';\nimport type { Request } from 'express';\nimport { RolesEnum } from '../enums/roles.enum';\nimport { IS_PUBLIC } from '../decorators/public.decorator';\nimport type { CustomRequest } from '../interfaces/custom-request.interface';\n\n@Injectable()\nexport class AuthGuard implements CanActivate {\n  constructor(\n    private configService: ConfigService,\n    private jwtService: JwtService,\n    private reflector: Reflector,\n  ) {}\n\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const isPublic = this.reflector.getAllAndOverride<boolean>(IS_PUBLIC, [\n      context.getHandler(),\n      context.getClass(),\n    ]);\n\n    if (isPublic) {\n      return true;\n    }\n\n    const req: CustomRequest = context.switchToHttp().getRequest();\n    const token = this.extractTokenFromHeader(req);\n\n    if (!token) {\n      throw new UnauthorizedException();\n    }\n\n    try {\n      const payload = await this.jwtService.verifyAsync<{\n        sub: string;\n        username: string;\n        role: RolesEnum;\n      }>(token, { secret: this.configService.get('JWT_SECRET') });\n      req['user'] = payload;\n    } catch {\n      throw new UnauthorizedException();\n    }\n\n    return true;\n  }\n\n  private extractTokenFromHeader(request: Request) {\n    const [type, token] = request.headers.authorization?.split(' ') ?? [];\n\n    return type === 'Bearer' && token;\n  }\n}\n","import { SetMetadata } from '@nestjs/common';\n\nexport const IS_PUBLIC = 'isPublic';\n/**\n * Decorator that marks a route as public, disabling authentication checks.\n */\nexport const Public = () => SetMetadata(IS_PUBLIC, true);\n","import {\n  type CanActivate,\n  type ExecutionContext,\n  Injectable,\n} from '@nestjs/common';\nimport { Reflector } from '@nestjs/core';\nimport { Observable } from 'rxjs';\nimport { RolesEnum } from '../enums/roles.enum';\nimport type { CustomRequest } from '../interfaces/custom-request.interface';\nimport { ROLES_KEY } from '../decorators/roles.decorator';\n\n@Injectable()\nexport class RoleGuard implements CanActivate {\n  constructor(private reflector: Reflector) {}\n\n  canActivate(\n    context: ExecutionContext,\n  ): boolean | Promise<boolean> | Observable<boolean> {\n    const allowedRoles = this.reflector.getAllAndOverride<RolesEnum[]>(\n      ROLES_KEY,\n      [context.getHandler(), context.getClass()],\n    );\n    const user = context.switchToHttp().getRequest<CustomRequest>().user;\n\n    if (!allowedRoles || !user) {\n      return true;\n    }\n\n    return allowedRoles.includes(user.role);\n  }\n}\n","import { SetMetadata } from '@nestjs/common';\nimport { RolesEnum } from '../enums/roles.enum';\n\nexport const ROLES_KEY = 'roles';\n/**\n * Decorator to set roles that can access to the decorated controller/action.\n * Use in combination with the RolesGuard to restrict access to certain roles.\n * @param roles - One or multiple roles that can access to the decorated controller/action.\n * @see {@link https://docs.nestjs.com/security/authorization#roles-based-authorization|NestJS - Roles-based authorization}\n */\nexport const Roles = (...roles: RolesEnum[]) => SetMetadata(ROLES_KEY, roles);\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,IAAAA,iBAAuB;;;ACAvB,oBAA2B;AAGpB,IAAM,gBAAN,MAAoB;AAAC;AAAf,gBAAN;AAAA,MADN,0BAAW;AAAA,GACC;;;ADDb,IAAAC,eAA0B;;;AEF1B,IAAAC,iBAKO;AACP,oBAA8B;AAC9B,kBAA0B;AAC1B,iBAA2B;;;ACR3B,IAAAC,iBAA4B;AAErB,IAAM,YAAY;;;ADalB,IAAM,YAAN,MAAuC;AAAA,EAC5C,YACU,eACA,YACA,WACR;AAHQ;AACA;AACA;AAAA,EACP;AAAA,EAEH,MAAM,YAAY,SAA6C;AAC7D,UAAM,WAAW,KAAK,UAAU,kBAA2B,WAAW;AAAA,MACpE,QAAQ,WAAW;AAAA,MACnB,QAAQ,SAAS;AAAA,IACnB,CAAC;AAED,QAAI,UAAU;AACZ,aAAO;AAAA,IACT;AAEA,UAAM,MAAqB,QAAQ,aAAa,EAAE,WAAW;AAC7D,UAAM,QAAQ,KAAK,uBAAuB,GAAG;AAE7C,QAAI,CAAC,OAAO;AACV,YAAM,IAAI,qCAAsB;AAAA,IAClC;AAEA,QAAI;AACF,YAAM,UAAU,MAAM,KAAK,WAAW,YAInC,OAAO,EAAE,QAAQ,KAAK,cAAc,IAAI,YAAY,EAAE,CAAC;AAC1D,UAAI,MAAM,IAAI;AAAA,IAChB,QAAQ;AACN,YAAM,IAAI,qCAAsB;AAAA,IAClC;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,uBAAuB,SAAkB;AAC/C,UAAM,CAAC,MAAM,KAAK,IAAI,QAAQ,QAAQ,eAAe,MAAM,GAAG,KAAK,CAAC;AAEpE,WAAO,SAAS,YAAY;AAAA,EAC9B;AACF;AA3Ca,YAAN;AAAA,MADN,2BAAW;AAAA,GACC;;;AEfb,IAAAC,iBAIO;AACP,IAAAC,eAA0B;;;ACL1B,IAAAC,iBAA4B;AAGrB,IAAM,YAAY;;;ADSlB,IAAM,YAAN,MAAuC;AAAA,EAC5C,YAAoB,WAAsB;AAAtB;AAAA,EAAuB;AAAA,EAE3C,YACE,SACkD;AAClD,UAAM,eAAe,KAAK,UAAU;AAAA,MAClC;AAAA,MACA,CAAC,QAAQ,WAAW,GAAG,QAAQ,SAAS,CAAC;AAAA,IAC3C;AACA,UAAM,OAAO,QAAQ,aAAa,EAAE,WAA0B,EAAE;AAEhE,QAAI,CAAC,gBAAgB,CAAC,MAAM;AAC1B,aAAO;AAAA,IACT;AAEA,WAAO,aAAa,SAAS,KAAK,IAAI;AAAA,EACxC;AACF;AAlBa,YAAN;AAAA,MADN,2BAAW;AAAA,GACC;;;AJCN,IAAM,eAAN,MAAmB;AAAC;AAAd,eAAN;AAAA,MARN,uBAAO;AAAA,IACN,WAAW;AAAA,MACT;AAAA,MACA,EAAE,SAAS,wBAAW,UAAU,UAAU;AAAA,MAC1C,EAAE,SAAS,wBAAW,UAAU,UAAU;AAAA,IAC5C;AAAA,IACA,SAAS,CAAC,aAAa;AAAA,EACzB,CAAC;AAAA,GACY;","names":["import_common","import_core","import_common","import_common","import_common","import_core","import_common"]}